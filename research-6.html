<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>研究方向 | 新的研究方向</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>

<body>
  <div class="shell">
    <!-- ===== Sidebar ===== -->
    <aside class="sidebar">
      <nav class="nav" aria-label="Site Navigation">
        <a href="index.html"><span class="pill"></span>团队主页</a>
        <a href="research.html"><span class="pill"></span>研究方向</a>
        <a href="papers.html"><span class="pill"></span>论文专著</a>
        <a href="team.html"><span class="pill"></span>研究团队</a>
      </nav>
    </aside>

    <!-- ===== Main ===== -->
    <main class="main">
      <div class="container">
        <section class="card" id="content">
          <h1 class="detail-title">加载中...</h1>
        </section>
      </div>
    </main>
  </div>

<script>
const mdUrl = 'content/research-6.md';

function escHtml(s){
  return s.replace(/[&<>"']/g, c => ({
    '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
  }[c]));
}

function parseMd(md){
  const lines = md.replace(/\r\n/g,'\n').split('\n');

  let title = '新的研究方向';
  const sections = [];
  let paperTail = '';
  let cur = null;

  function push(){
    if(!cur) return;
    cur.p = cur.pLines.join('\n').trim();
    delete cur.pLines;
    sections.push(cur);
    cur = null;
  }

  for(const raw of lines){
    const line = raw.trim();
    if(!line) continue;

    if(line.startsWith('# ')){
      title = line.slice(2).trim();
      continue;
    }
    if(line.startsWith('## ')){
      push();
      cur = { h: line.slice(3).trim(), pLines: [], img:'', cap:'' };
      continue;
    }
    if(line.startsWith('图片：')){
      if(cur) cur.img = line.replace('图片：','').trim();
      continue;
    }
    if(line.startsWith('图题：')){
      if(cur) cur.cap = line.replace('图题：','').trim();
      continue;
    }
    if(line.startsWith('论文专著：')){
      paperTail = line.replace('论文专著：','').trim();
      continue;
    }

    if(!cur) cur = { h:'说明', pLines:[], img:'', cap:'' };
    cur.pLines.push(raw);
  }
  push();
  return { title, sections, paperTail };
}

function buildSection(sec){
  return `
    <div class="stack-item">
      <div class="stack-h">${escHtml(sec.h)}</div>
      <p class="stack-p">${escHtml(sec.p).replace(/\n/g,'<br>')}</p>
      ${
        sec.img ? `
        <figure class="figure" style="margin-top:12px;">
          <img src="${escHtml(sec.img)}" alt="${escHtml(sec.cap || '')}">
          ${sec.cap ? `<figcaption>${escHtml(sec.cap)}</figcaption>` : ''}
        </figure>` : ''
      }
    </div>
  `;
}

fetch(mdUrl)
  .then(r=>r.text())
  .then(md=>{
    const data = parseMd(md);
    document.title = '研究方向 | ' + data.title;

    const html = `
      <h1 class="detail-title">${escHtml(data.title)}</h1>
      <div class="detail-stack">
        ${data.sections.map(buildSection).join('')}
        <div class="stack-item">
          <div class="stack-h">论文专著</div>
          <p class="stack-p">
            详见 <a class="hot" href="papers.html">“论文专著”</a> 部分 —— ${escHtml(data.paperTail)}
          </p>
        </div>
      </div>
      <p class="backline"><a class="hot" href="research.html">← 返回研究方向</a></p>
    `;
    document.getElementById('content').innerHTML = html;
  });

/* 导航高亮 */
const path = location.pathname.split('/').pop() || 'index.html';
document.querySelectorAll('.nav a').forEach(a=>{
  if(a.getAttribute('href')===path) a.classList.add('active');
});
</script>
</body>
</html>
